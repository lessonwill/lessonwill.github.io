---
title: "小米音箱hack记"
date: 2023-12-12
---
# 目标
实现gpt对话  
暂时只搞定了TTS。未完待续。。。
```
pip3 install miservice

export MI_USER=xxx@xx.com
export MI_PASS=xx
micli.py list
[
  {
    "name": "小爱音箱",
    "model": "xiaomi.wifispeaker.l06a",
    "did": "xx",
    "token": "xx"
  }
]

export MI_DID=xx
micli.py spec xiaomi.wifispeaker.l06a
# Generated by https://github.com/Yonsm/MiService
# http://miot-spec.org/miot-spec-v2/instance?type=urn:miot-spec-v2:device:speaker:0000A015:xiaomi-l06a:2

Device_Information = 1
    Device_Manufacturer = 1
    Device_Model = 2
    Device_Serial_Number = 3
    Current_Firmware_Version = 4

Speaker = 2
    Volume = 1  # uint8  # rw
    Mute = 2  # bool  # rw

Play_Control = 3
    _Playing_State = 1  # uint8  # n

    _Play = 1
    _Pause = 2
    _Next = 3
    _Previous = 4

Microphone = 4
    Mute = 1  # bool  # rw

Intelligent_Speaker = 5
    _Text_Content = 1
    _Silent_Execution = 2  # uint8
    Sleep_Mode = 3  # bool  # rwn
    Audio_Id = 4  # rn

    _Play_Text = 1  # in=[1]
    _Wake_Up = 2  # in=[1]
    _Play_Radio = 3
    _Play_Music = 4
    _Execute_Text_Directive = 5  # in=[1, 2]

Clock = 6

    _Stop_Alarm = 1

Speaker_Volume
    MIN = 6
    MAX = 99
    STEP = 3

Play_Control_Playing_State
    Stop = 0
    Playing = 1
    Pause = 2

Intelligent_Speaker_Silent_Execution
    On = 0
    Off = 1

 micli.py 2-1
[
  "57"
]

# 设置音量，生效了，但是会返回0，也无法回读。
micli.py 2=#30
[
  0
]

export MI_DID=xx
root@fd58c3213747:/# micli.py 5 hello
0
root@fd58c3213747:/# micli.py 5 "hello"
0
root@fd58c3213747:/# micli.py 5 "床前明月光，疑是地上霜，举头望明月，低头思故乡"
```
